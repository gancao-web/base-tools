/**
 * è®¡ç®—å­—ç¬¦ä¸²åœ¨ UTF-8 ç¼–ç ä¸‹çš„å­—èŠ‚é•¿åº¦ã€‚
 * ä½¿ç”¨åœºæ™¯ï¼š
 * 1) æŒ‰å­—èŠ‚é™åˆ¶è¡¨å•è¾“å…¥ï¼ˆé¿å…è¶…è¿‡åç«¯/æ•°æ®åº“å­—æ®µä¸Šé™ï¼‰
 * 2) è¯„ä¼°ç½‘ç»œä¼ è¾“ã€ç¼“å­˜ï¼ˆRedis/æ¶ˆæ¯é˜Ÿåˆ—ï¼‰å¼€é”€
 * 3) æ ¹æ®å­—èŠ‚æ•°æˆªæ–­æˆ–æç¤ºç”¨æˆ·ï¼ˆè€ŒéæŒ‰å­—ç¬¦æ•°ï¼‰
 * @param str è¾“å…¥çš„å­—ç¬¦ä¸²
 * @returns å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦
 * @example
 * getStringByteLength('abc') // 3
 * getStringByteLength('ä¸­æ–‡') // 6
 * getStringByteLength('ğŸ˜Š') // 4
 */
export function getStringByteLength(str: string): number {
  let byteLen = 0;

  for (let i = 0; i < str.length; i++) {
    const code = str.charCodeAt(i);

    if (code <= 0x7f) {
      byteLen += 1; // ï¼ˆASCII åŸºæœ¬æ‹‰ä¸ï¼‰â†’ åŒ…å«æ•°å­— 0-9ã€è‹±æ–‡å­—æ¯ A-Z/a-zã€å¸¸è§ç¬¦å·
    } else if (code <= 0x7ff) {
      byteLen += 2; // ï¼ˆæ‹‰ä¸æ‰©å±•ï¼‰â†’ åŒ…å«æ‹‰ä¸å­—æ¯ï¼ˆå«å˜éŸ³ç¬¦ï¼‰ã€å¸Œè…Šæ–‡ã€ä¿„æ–‡/è¥¿é‡Œå°”æ–‡ã€å¸Œä¼¯æ¥æ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ç­‰
    } else if (code >= 0xd800 && code <= 0xdbff) {
      byteLen += 4; // ï¼ˆUTF-16 ä»£ç†é¡¹ï¼‰â†’ åŒ…å« emojiã€ç¨€æœ‰æ±‰å­—ï¼ˆæ‰©å±•åŒºï¼‰ã€éŸ³ä¹ç¬¦å·ç­‰
      i++;
    } else {
      byteLen += 3; // ï¼ˆBMP ç»å¤§éƒ¨åˆ†ï¼‰â†’ åŒ…å«ä¸­æ–‡/æ—¥æ–‡/éŸ©æ–‡çš„å¤§å¤šæ•°å­—ç¬¦ï¼ˆCJK ç»Ÿä¸€æ±‰å­—ï¼‰ã€ä»¥åŠå¤§é‡å…¶å®ƒè„šæœ¬
    }
  }

  return byteLen;
}
